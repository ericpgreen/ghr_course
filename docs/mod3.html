<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Module 3 – Global Health Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Global Health Research</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./371.html"> 
<span class="menu-text">GLHLTH 371 / PSY 309</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./702.html"> 
<span class="menu-text">GLHLTH 702</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modules" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Modules</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modules">    
        <li>
    <a class="dropdown-item" href="./mod1.html">
 <span class="dropdown-text">Module 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./mod2.html">
 <span class="dropdown-text">Module 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#select-a-research-design" id="toc-select-a-research-design" class="nav-link active" data-scroll-target="#select-a-research-design">Select a Research Design</a></li>
  <li><a href="#and-3.2-experimental" id="toc-and-3.2-experimental" class="nav-link" data-scroll-target="#and-3.2-experimental">3.1 and 3.2: Experimental</a>
  <ul class="collapse">
  <li><a href="#prepare" id="toc-prepare" class="nav-link" data-scroll-target="#prepare">Prepare</a></li>
  <li><a href="#during-class" id="toc-during-class" class="nav-link" data-scroll-target="#during-class">During Class</a></li>
  </ul></li>
  <li><a href="#quasi-experimental" id="toc-quasi-experimental" class="nav-link" data-scroll-target="#quasi-experimental">3.3-3.4: Quasi-experimental</a>
  <ul class="collapse">
  <li><a href="#prepare-1" id="toc-prepare-1" class="nav-link" data-scroll-target="#prepare-1">Prepare</a></li>
  <li><a href="#during-class-1" id="toc-during-class-1" class="nav-link" data-scroll-target="#during-class-1">During Class</a></li>
  </ul></li>
  <li><a href="#confounder-control-descriptive" id="toc-confounder-control-descriptive" class="nav-link" data-scroll-target="#confounder-control-descriptive">3.5-3.6: Confounder-control / Descriptive</a>
  <ul class="collapse">
  <li><a href="#prepare-2" id="toc-prepare-2" class="nav-link" data-scroll-target="#prepare-2">Prepare</a></li>
  <li><a href="#during-class-2" id="toc-during-class-2" class="nav-link" data-scroll-target="#during-class-2">During Class</a></li>
  </ul></li>
  <li><a href="#homework" id="toc-homework" class="nav-link" data-scroll-target="#homework">Homework</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Module 3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="select-a-research-design" class="level2">
<h2 class="anchored" data-anchor-id="select-a-research-design">Select a Research Design</h2>
<p>By the end of this module, you should be able to:</p>
<ul>
<li>Articulate the benefits and limitations of random assignment</li>
<li>Explain the logic and limitations of different quasi-experimental and observational designs that can be used when randomization is not possible or ethical</li>
</ul>
</section>
<section id="and-3.2-experimental" class="level2">
<h2 class="anchored" data-anchor-id="and-3.2-experimental">3.1 and 3.2: Experimental</h2>
<p>In global health, we’re often interested in knowing what treatments, programs, interventions, and policies “work” and why. To answer questions of impact, we often turn to randomized controlled trials, a mainstay of medical research. In this session we’ll explore the rationale, process, and limitations of experiments.</p>
<section id="prepare" class="level3">
<h3 class="anchored" data-anchor-id="prepare">Prepare</h3>
<ul>
<li><a href="https://drive.google.com/file/d/0Bxn_jkXZ1lxuWkhFcTUzdWVkZ0E/view?usp=sharing&amp;resourcekey=0-9m_tdrVXCaO9MPCTlM_txQ">CYOA diagram</a></li>
<li>Read Chapter 2 “Why Randomize?” in Glennerster, R. &amp; Takavarasha, K. (2013). <a href="https://amzn.to/30cmbdE" target="_blank"><em>Running Randomized Evaluations: A Practical Guide</em></a> (Box, see pinned post on Ed)</li>
<li>Review <a href="http://www.equator-network.org/reporting-guidelines/consort/" target="_blank">CONSORT statement and guidelines</a></li>
<li>Skim articles in activity, focus on methods</li>
</ul>
</section>
<section id="during-class" class="level3">
<h3 class="anchored" data-anchor-id="during-class">During Class</h3>
<ul>
<li><a href="https://drive.google.com/file/d/1KNEZYlgiutbOpZ988-U-z694_KJJUEpK/view?usp=share_link">Deck</a></li>
<li><a href="https://docs.google.com/document/d/1iDar3zonTYEQ3yE1AAiD_-pbwP5Fe8UvWbSJGEzOp1U/edit?usp=sharing">Activity 1</a></li>
<li><a href="https://docs.google.com/document/d/1tOdyB_HhuRom6Q3kDI1quBrJDiUR8963g0DIi5ASR5s/edit?usp=sharing">Activity 2</a></li>
</ul>
</section>
</section>
<section id="quasi-experimental" class="level2">
<h2 class="anchored" data-anchor-id="quasi-experimental">3.3-3.4: Quasi-experimental</h2>
<p>When randomization is not possible or ethical, we have to rely on nonrandomized studies for causal inference. There are two main types of nonrandomized studies: quasi-experimental and observational. The quasi-experimental designs we’ll discuss in these sessions all feature a cause that is manipulated prior to observing the outcome, but they lack random assignment.</p>
<section id="prepare-1" class="level3">
<h3 class="anchored" data-anchor-id="prepare-1">Prepare</h3>
<ul>
<li>Review <a href="https://www.cdc.gov/trendstatement/" target="_blank">TREND statement and guidelines</a></li>
<li>Read the Introduction and Method sections of the following articles:
<ul>
<li><strong>Pre-Post:</strong> Cluver, L., Meinck, F., Yakubovich, A., Doubt, J., Redfern, A., Ward, C., … &amp; Romero, R. H. (2016). Reducing child abuse amongst adolescents in low-and middle-income countries: a pre-post trial in South Africa. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5137206/" target="_blank"><em>BMC Public Health, 16(1)</em></a>, 567.</li>
<li><strong>Post-Test Only:</strong> Mitchell, S., Gelman, A., Ross, R., Chen, J., Bari, S., Huynh, U. K., … &amp; Makela, S. (2018). The Millennium Villages Project: a retrospective, observational, endline evaluation. <a href="https://www.thelancet.com/journals/langlo/article/PIIS2214-109X(18)30065-2/fulltext" target="_blank"><em>The Lancet Global Health, 6(5)</em></a>, e500-e513.</li>
<li><strong>Difference-in-Differences:</strong> McKinnon, B., Harper, S., Kaufman, J. S., &amp; Bergevin, Y. (2015). Removing user fees for facility-based delivery services: a difference-in-differences evaluation from ten sub-Saharan African countries. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4385820/" target="_blank"><em>Health Policy and Planning, 30(4)</em></a>, 432-441.</li>
<li><strong>Interrupted Time Series:</strong> Rashidian, A., Joudaki, H., Khodayari-Moez, E., Omranikhoo, H., Geraili, B., &amp; Arab, M. (2013). The impact of rural health system reform on hospitalization rates in the Islamic Republic of Iran: an interrupted time series. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3845261/" target="_blank"><em>Bulletin of the World Health Organization, 91(12)</em></a>, 942-949.</li>
<li><strong>Regression Discontinuity</strong>: Smith, L. M., Kaufman, J. S., Strumpf, E. C., &amp; Lévesque, L. E. (2015). Effect of human papillomavirus (HPV) vaccination on clinical indicators of sexual behaviour among adolescent girls: The Ontario Grade 8 HPV Vaccine Cohort Study. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4312170/" target="_blank"><em>Canadian Medical Association Journal, 187(2)</em></a>, E74-E81.</li>
</ul></li>
</ul>
</section>
<section id="during-class-1" class="level3">
<h3 class="anchored" data-anchor-id="during-class-1">During Class</h3>
<ul>
<li><a href="https://drive.google.com/file/d/1HvfS3P3UglpDcs_IWUKAGBHT8qUZcW9T/view?usp=share_link">Deck</a></li>
<li><a href="https://docs.google.com/document/d/1afyOM7V2dUXY0op-h35DA6nOSPcKjUuwVe6UAGT5Nv4/edit?usp=sharing">Activity</a></li>
</ul>
<section id="the-quasi-experimentalist-john-snow" class="level4">
<h4 class="anchored" data-anchor-id="the-quasi-experimentalist-john-snow">The quasi-experimentalist John Snow</h4>
<p><em>This activity was designed by <a href="https://sites.google.com/site/amyfinnegan/home" target="_blank">Amy Finnegan</a> (with credit due to <a href="https://www.amazon.com/dp/B00MZG71MC/ref=dp-kindle-redirect?_encoding=UTF8&amp;btkr=1" target="_blank">Mastering Metrics</a>). I probably made it less cool with my edits over time.</em></p>
<p>Difference-in-difference analysis is one of the oldest tricks in the book. In the mid-1800s, John Snow used this method to discover how residents of London were being infected with cholera.</p>
<p>Snow observed that the Southwark and Vauxhall Company and the Lambeth Company supplied water to high-death-rate districts in South London. Both companies used the Thames—which was highly contaminated—as their water source before 1852. In 1852, the Lambeth Company began to source water from the Thames Ditton river—which was upstream and uncontaminated. Snow was able to show that between 1849 and 1854, districts that remained supplied by the Southwark and Vauxhall Company saw an increase in deaths from cholera while those supplied by the Lambeth Company experienced a reduction in deaths from cholera.</p>
<p>Use <a href="http://www.ph.ucla.edu/epi/snow/table12a.html" target="_blank">this table</a> taken from Snow’s original 1855 article to reproduce Snow’s difference-in-difference estimates.</p>
<p><img src="images/snowtable.png" class="img-fluid"></p>
</section>
</section>
</section>
<section id="confounder-control-descriptive" class="level2">
<h2 class="anchored" data-anchor-id="confounder-control-descriptive">3.5-3.6: Confounder-control / Descriptive</h2>
<section id="prepare-2" class="level3">
<h3 class="anchored" data-anchor-id="prepare-2">Prepare</h3>
<ul>
<li>Review <a href="https://www.strobe-statement.org/index.php?id=strobe-home" target="_blank">STROBE statement and guidelines</a></li>
<li>Read the Introduction and Method sections of the following articles:
<ul>
<li><strong>Case Report:</strong> Centers for Disease Control CDC. (1981). Pneumocystis pneumonia–Los Angeles. <a href="https://www.cdc.gov/mmwr/preview/mmwrhtml/june_5.htm" target="_blank"><em>MMWR. Morbidity and mortality weekly report, 30(21)</em></a>.</li>
<li><strong>Cross-Sectional:</strong> Ahmed, S., Choi, Y., Rimon, J. G., Alzouma, S., Gichangi, P., Guiella, G., … &amp; Omoluabi, E. (2019). Trends in contraceptive prevalence rates in sub-Saharan Africa since the 2012 London Summit on Family Planning: results from repeated cross-sectional surveys. <a href="https://www.thelancet.com/journals/langlo/article/PIIS2214-109X(19)30200-1/fulltext" target="_blank"><em>The Lancet Global Health, 7(7)</em></a>, e904-e911.</li>
<li><strong>Case-Control:</strong> Shrivastava, A., Kumar, A., Thomas, J. D., Laserson, K. F., Bhushan, G., Carter, M. D., … &amp; Dwivedi, M. (2017). Association of acute toxic encephalopathy with litchi consumption in an outbreak in Muzaffarpur, India, 2014: a case-control study. <a href="https://www.thelancet.com/journals/langlo/article/PIIS2214-109X(17)30035-9/fulltext" target="_blank"><em>The Lancet Global Health, 5(4)</em></a>, e458-e466.</li>
<li><strong>Retrospective Cohort:</strong> Shah, T., Greig, J., van der Plas, L. M., Achar, J., Caleo, G., Squire, J. S., … &amp; Vogt, F. (2016). Inpatient signs and symptoms and factors associated with death in children aged 5 years and younger admitted to two Ebola management centres in Sierra Leone, 2014: a retrospective cohort study. <a href="https://www.thelancet.com/journals/langlo/article/PIIS2214-109X(16)30097-3/fulltext" target="_blank"><em>The Lancet Global Health, 4(7)</em></a>, e495-e501.</li>
<li><strong>Prospective Cohort:</strong> Oliosi, J. G. N., Reis-Santos, B., Locatelli, R. L., Sales, C. M. M., da Silva Filho, W. G., da Silva, K. C., … &amp; Pereira, S. M. (2019). Effect of the Bolsa Familia Programme on the outcome of tuberculosis treatment: a prospective cohort study. <a href="https://www.thelancet.com/journals/langlo/article/PIIS2214-109X(18)30478-9/fulltext" target="_blank"><em>The Lancet Global Health, 7(2)</em></a>, e219-e226.</li>
</ul></li>
</ul>
</section>
<section id="during-class-2" class="level3">
<h3 class="anchored" data-anchor-id="during-class-2">During Class</h3>
<ul>
<li><a href="https://drive.google.com/file/d/1aIeNlvLznIqZaWDuYOOlqqUly2IM9BZ2/view?usp=share_link">Deck</a></li>
<li><a href="https://docs.google.com/document/d/1StXoyZW6qQFwOC2iWIBVwESgb1a6wbaQ6eoNb0cE3kU/edit?usp=sharing">Activity</a></li>
<li><a href="https://docs.google.com/document/d/1s4EzHmO0UuBMB0gLj_XFUr-KC0Utx1Vdvn_XzqVuIXE/edit">Bonus</a></li>
</ul>
</section>
</section>
<section id="homework" class="level2">
<h2 class="anchored" data-anchor-id="homework">Homework</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Assignment</th>
<th style="text-align: left;">Due Date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><a href="https://docs.google.com/document/d/17qy2CRxejEAkLLNpIhEFlF8YmVuppEjO7yIBZORopsw/edit?usp=sharing" target="_blank">Module 3 homework</a></td>
<td style="text-align: left;">Nov 14</td>
</tr>
</tbody>
</table>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>